name: Linting CI

on:
  push:
    paths:
      - 'nexus-sus-engine/**'
      - 'api/**'
      - 'nexus-sus-etl/**'
  pull_request:
    paths:
      - 'nexus-sus-engine/**'
      - 'api/**'
      - 'nexus-sus-etl/**'
  workflow_dispatch:

permissions:
  contents: read

jobs:
  cpp-lint:
    name: C++ Lint (Engine)
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Install Linting Tools
        run: |
          sudo apt-get update
          sudo apt-get install -y clang-format cppcheck

      - name: Run Clang-Format
        run: |
          find nexus-sus-engine/ -name "*.cpp" -o -name "*.h" | xargs clang-format --style=file --dry-run -Werror

      - name: Run Cppcheck (Memory Hygiene)
        run: |
          cppcheck --enable=all --error-exitcode=1 --suppress=missingIncludeSystem nexus-sus-engine/

  go-lint:
    name: Go Lint (API)
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Set up Go
        uses: actions/setup-go@v5
        with:
          go-version: '1.21'
      - name: Run Gofmt
        run: gofmt -l -d api/
  python-lint:
     name: Python Lint (ETL)
     runs-on: ubuntu-latest
     steps:
      - uses: actions/checkout@v4
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
           python-version: '3.11'
      - name: Install dependencies
        run: pip install black isort
      - name: Run Black
        run: black nexus-sus-etl/
      - name: Run isort
        run: isort nexus-sus-etl/
      - name: Commit changes
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "style: format code with black and isort"